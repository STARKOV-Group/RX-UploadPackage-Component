spec:
  inputs:
    stage:
      default: RX-UploadPackage
    rules:
      default: '"true" == "true"'
---
RX-UploadPackage-Component:
  tags:
    - $RunnerTags
  stage: $[[ inputs.stage ]]
  rules: 
    - if: $[[ inputs.rules ]] && ($DeployMode == "upload" || $DeployMode == "combined")
      when: on_success
    - if: $[[ inputs.rules ]] && $DeployMode != "upload" && $DeployMode != "combined"
      when: never
  script:
    # Переопределение путей с учетом веток. При изменении логики также поменять в BuildPackage, PreparedServer, DeployDTPackage, UploadPackage и VersionUp компонентах
    - $FormattedBranchName = ($CI_COMMIT_BRANCH -replace '\W', '_')

    - C:\CICD\Tools\NextCloudConnector\NextCloudConnector.exe -u $CloudUserName -w $CloudUserPassword -l "https://адрес-облака.ru" -n $CI_PROJECT_NAMESPACE -b $CI_COMMIT_BRANCH -p $PackageProjectPath -f $FormattedBranchName -c $UploadFolder
